import click
import sys
import drawing as drw

from PyQt5.QtGui import *
from PyQt5.QtWidgets import *
from PyQt5.QtCore import *

from PIL import Image, ImageEnhance, ImageDraw, ImageOps


class App(QWidget):

    def __init__(self):
        super().__init__()

        # Window init
        self.setWindowTitle('bl_draw GUI')

        # Layout
        hbox = QHBoxLayout()

        vbox = QVBoxLayout()

        l_image = QLabel()
        vbox.addWidget(l_image)

        im = drw.draw_moon(int(1000), 0.3, 0, True)
        im = im.convert("RGB")
        data = im.tobytes("raw", "RGB")
        qim = QImage(data, im.size[0], im.size[1], QImage.Format_RGB888)
        pixmap = QPixmap.fromImage(qim)
        l_image.setPixmap(qim)

        h_spacer = QSpacerItem(
            400, 1, QSizePolicy.Minimum, QSizePolicy.Expanding)
        vbox.addItem(h_spacer)
        hbox.addLayout(vbox, 1)

        

        self.setLayout(hbox)
        self.show()

@click.command()
@click.option('--lit', default=10.0, help='Percentage of the moon lit by the bright limb. (0 to 100)')
@click.option('--angle', default=0, help='Angle of the bright limb (degrees) (0 to 360).')
@click.option('--size', default=500, help='Width (and height) of the image in pixels (10 to 10,000).')
@click.option('--gui', default=False, help='Start the GUI for drawing.')
def draw(lit, angle, size, gui):

    if gui:
        app = QApplication(sys.argv)
        ex = App()
        sys.exit(app.exec_())

    if lit > 100 or lit < 0:
        print(f'--lit needs to be between 0 and 100, not {lit}')
        quit()

    if angle > 360 or angle < 0:
        print(f'--angle needs to be between 0 and 360, not {angle}')
        quit()

    if size > 10000 or size < 10:
        print(f'--size needs to be between 10 and 10,000, not {size}')
        quit()

    print(f'Drawing a moon with a lit percentage of {lit}% and angle of {angle} degrees.')

    drw.draw_moon(int(size), lit, angle, True).show()

if __name__ == '__main__':
    draw()